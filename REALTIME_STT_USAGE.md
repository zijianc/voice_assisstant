# å®æ—¶ STT èŠ‚ç‚¹å¯åŠ¨è„šæœ¬ä½¿ç”¨è¯´æ˜

## ğŸ“ å¯ç”¨è„šæœ¬

### 1. `start_realtime_stt.sh` - å®Œæ•´ç‰ˆå¯åŠ¨è„šæœ¬
åŠŸèƒ½é½å…¨çš„å¯åŠ¨è„šæœ¬ï¼ŒåŒ…å«ç¯å¢ƒæ£€æŸ¥ã€å‚æ•°é…ç½®å’Œé”™è¯¯å¤„ç†ã€‚

**åŸºæœ¬ä½¿ç”¨:**
```bash
./start_realtime_stt.sh
```

**è‡ªå®šä¹‰å‚æ•°:**
```bash
# é«˜çµæ•åº¦é…ç½®
./start_realtime_stt.sh --vad-threshold 0.010

# å¿«é€Ÿå“åº”é…ç½®
./start_realtime_stt.sh --silence-duration 1.0

# å¤§ç¼“å†²åŒºé…ç½®
./start_realtime_stt.sh --buffer-history 2.5

# è°ƒè¯•æ¨¡å¼
./start_realtime_stt.sh --debug

# ç»„åˆå‚æ•°
./start_realtime_stt.sh --vad-threshold 0.012 --buffer-history 2.0 --debug
```

**æ”¯æŒçš„å‚æ•°:**
- `--vad-threshold <å€¼>`: VAD é˜ˆå€¼ (é»˜è®¤: 0.015)
- `--silence-duration <å€¼>`: é™éŸ³æ£€æµ‹æ—¶é—´ (é»˜è®¤: 2.0ç§’)
- `--min-speech-duration <å€¼>`: æœ€å°è¯­éŸ³æ—¶é•¿ (é»˜è®¤: 0.2ç§’)
- `--buffer-history <å€¼>`: å‰ç¼“å†²åŒºæ—¶é—´ (é»˜è®¤: 1.5ç§’)
- `--debug`: å¯ç”¨è¯¦ç»†æ—¥å¿—

### 2. `start_realtime_stt_simple.sh` - ç®€åŒ–ç‰ˆå¯åŠ¨è„šæœ¬
å¿«é€Ÿå¯åŠ¨ï¼Œæœ€å°‘é…ç½®ï¼Œé€‚åˆæ—¥å¸¸ä½¿ç”¨ã€‚

```bash
./start_realtime_stt_simple.sh
```

### 3. `test_realtime_stt.sh` - äº¤äº’å¼æµ‹è¯•è„šæœ¬
æä¾›å¤šç§é…ç½®é€‰é¡¹çš„æµ‹è¯•ç•Œé¢ã€‚

```bash
./test_realtime_stt.sh
```

## ğŸ”§ å‚æ•°é…ç½®æŒ‡å—

### VAD é˜ˆå€¼ (vad_threshold)
æ§åˆ¶è¯­éŸ³æ´»åŠ¨æ£€æµ‹çš„æ•æ„Ÿåº¦:
- **0.010**: éå¸¸æ•æ„Ÿï¼Œé€‚åˆå®‰é™ç¯å¢ƒ
- **0.015**: é»˜è®¤å€¼ï¼Œå¹³è¡¡æ€§èƒ½
- **0.025**: è¾ƒä½æ•æ„Ÿåº¦ï¼Œé€‚åˆå˜ˆæ‚ç¯å¢ƒ

### é™éŸ³æ£€æµ‹æ—¶é—´ (silence_duration)
è¯­éŸ³ç»“æŸåç­‰å¾…çš„é™éŸ³æ—¶é—´:
- **1.0ç§’**: å¿«é€Ÿå“åº”ï¼Œé€‚åˆçŸ­å¥
- **2.0ç§’**: é»˜è®¤å€¼ï¼Œé€‚åˆæ­£å¸¸å¯¹è¯
- **3.0ç§’**: è¾ƒé•¿ç­‰å¾…ï¼Œé€‚åˆæ€è€ƒæ€§å¯¹è¯

### å‰ç¼“å†²åŒºæ—¶é—´ (buffer_history)
è¯­éŸ³å¼€å§‹å‰ä¿ç•™çš„éŸ³é¢‘æ—¶é—´:
- **1.0ç§’**: è¾ƒçŸ­ç¼“å†²åŒº
- **1.5ç§’**: é»˜è®¤å€¼ï¼Œç¡®ä¿æ•è·å®Œæ•´å”¤é†’è¯
- **2.5ç§’**: å¤§ç¼“å†²åŒºï¼Œé€‚åˆç¡®ä¿å®Œæ•´æ€§

## ğŸ¯ ä½¿ç”¨åœºæ™¯æ¨è

### å®‰é™ç¯å¢ƒ + å¿«é€Ÿå“åº”
```bash
./start_realtime_stt.sh --vad-threshold 0.010 --silence-duration 1.0
```

### å˜ˆæ‚ç¯å¢ƒ + ç¨³å®šæ€§ä¼˜å…ˆ
```bash
./start_realtime_stt.sh --vad-threshold 0.025 --buffer-history 2.5
```

### è°ƒè¯•å’Œä¼˜åŒ–
```bash
./start_realtime_stt.sh --debug --vad-threshold 0.012
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **èŠ‚ç‚¹å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ OPENAI_API_KEY æ˜¯å¦è®¾ç½®
   - ç¡®ä¿å·²æ„å»ºåŒ…: `colcon build --packages-select my_voice_assistant`

2. **éŸ³é¢‘æƒé™é”™è¯¯**
   - æ£€æŸ¥ Docker å®¹å™¨çš„éŸ³é¢‘è®¾å¤‡è®¿é—®æƒé™
   - ç¡®ä¿ pyaudio æ­£ç¡®å®‰è£…

3. **VAD è¿‡äºæ•æ„Ÿ/ä¸æ•æ„Ÿ**
   - è°ƒæ•´ `--vad-threshold` å‚æ•°
   - ä½¿ç”¨ `--debug` æ¨¡å¼è§‚å¯Ÿ RMS å€¼

4. **å”¤é†’è¯è¯†åˆ«ä¸å‡†ç¡®**
   - å¢åŠ  `--buffer-history` å€¼
   - é™ä½ `--vad-threshold` å€¼
   - ç¡®ä¿æ¸…æ™°å‘éŸ³

### ç›‘æ§å’Œè°ƒè¯•

ç›‘å¬è½¬å½•ç»“æœ:
```bash
ros2 topic echo /speech_text
```

æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€:
```bash
ros2 node list | grep stt
```

æŸ¥çœ‹è¯¦ç»†æ—¥å¿—:
```bash
./start_realtime_stt.sh --debug
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| é…ç½® | å»¶è¿Ÿ | å‡†ç¡®æ€§ | èµ„æºæ¶ˆè€— | é€‚ç”¨åœºæ™¯ |
|------|------|--------|----------|----------|
| é«˜æ•æ„Ÿåº¦ | ä½ | ä¸­ | é«˜ | å®‰é™ç¯å¢ƒ |
| é»˜è®¤é…ç½® | ä¸­ | é«˜ | ä¸­ | ä¸€èˆ¬ä½¿ç”¨ |
| ä½æ•æ„Ÿåº¦ | é«˜ | é«˜ | ä½ | å˜ˆæ‚ç¯å¢ƒ |

## ğŸ”— ç›¸å…³è¯é¢˜

- **å‘å¸ƒ**: `/speech_text` - è½¬å½•çš„æ–‡æœ¬ç»“æœ
- **è®¢é˜…**: `/tts_status` - TTS æ’­æ”¾çŠ¶æ€

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ç¯å¢ƒå‡†å¤‡**: ç¡®ä¿ç›¸å¯¹å®‰é™çš„ç¯å¢ƒ
2. **æ¸…æ™°å‘éŸ³**: å”¤é†’è¯éœ€è¦æ¸…æ™°å‡†ç¡®
3. **é€‚å½“åœé¡¿**: è¯­å¥é—´ä¿æŒé€‚å½“åœé¡¿
4. **å‚æ•°è°ƒä¼˜**: æ ¹æ®ç¯å¢ƒè°ƒæ•´ VAD å‚æ•°
5. **ç›‘æ§æ—¥å¿—**: ä½¿ç”¨è°ƒè¯•æ¨¡å¼ä¼˜åŒ–é…ç½®
