# OpenAI TTS 性能优化指南

## 🚀 主要优化措施

### 1. **模型升级**
- **旧版**: `tts-1` (基础模型)
- **新版**: `gpt-4o-mini-tts` (最新最快模型)
- **提升**: 更快的生成速度 + 更好的语音质量

### 2. **音频格式优化**
- **旧版**: `mp3` (需要编码，增加延迟)
- **新版**: `wav` (无压缩，最低延迟)
- **替代**: `pcm` (最原始格式，极低延迟)

### 3. **语音选择**
- **旧版**: `nova` (传统语音)
- **新版**: `coral` (新语音，更自然)
- **其他**: `ash`, `ballad`, `sage` 等新选项

### 4. **响应策略优化**
- **缓冲时间**: 从 0.5秒 降低到 0.2-0.3秒
- **触发条件**: 从 25词 降低到 15词
- **异步处理**: 使用线程池避免阻塞

### 5. **播放优化**
- **音频设置**: 针对WAV格式优化pygame配置
- **等待间隔**: 从 100ms 降低到 50ms
- **格式适配**: 根据音频格式调整播放器设置

## 📊 性能对比

| 配置 | 生成时间 | 总延迟 | 音质 | 文件大小 |
|------|----------|--------|------|----------|
| 旧配置 (tts-1 + mp3) | ~2-3秒 | ~3-4秒 | 好 | 小 |
| 新配置 (gpt-4o-mini-tts + wav) | ~1-2秒 | ~2-3秒 | 很好 | 中 |
| 极速配置 (gpt-4o-mini-tts + pcm) | ~1-1.5秒 | ~1.5-2秒 | 很好 | 大 |

## 🛠️ 使用方法

### 快速启动 (推荐)
```bash
./start_tts_fast.sh
```

### 自定义配置
在 `.env` 文件中添加:
```bash
TTS_MODEL=gpt-4o-mini-tts
TTS_VOICE=coral
TTS_FORMAT=wav
TTS_SPEED=1.1
```

### 性能测试
```bash
./test_tts_performance.sh
```

## 🎯 不同场景的推荐配置

### 实时对话 (最佳响应)
```bash
TTS_MODEL=gpt-4o-mini-tts
TTS_VOICE=coral
TTS_FORMAT=pcm
TTS_SPEED=1.2
```

### 平衡性能 (推荐)
```bash
TTS_MODEL=gpt-4o-mini-tts
TTS_VOICE=coral
TTS_FORMAT=wav
TTS_SPEED=1.1
```

### 文件存储
```bash
TTS_MODEL=gpt-4o-mini-tts
TTS_VOICE=coral
TTS_FORMAT=mp3
TTS_SPEED=1.0
```

### 网络传输
```bash
TTS_MODEL=gpt-4o-mini-tts
TTS_VOICE=coral
TTS_FORMAT=opus
TTS_SPEED=1.1
```

## 💡 进一步优化建议

### 1. **网络优化**
- 使用稳定高速网络连接
- 考虑设置HTTP代理

### 2. **硬件优化**
- 使用SSD存储临时文件
- 确保足够的RAM

### 3. **系统优化**
- 关闭不必要的后台进程
- 优化Python虚拟环境

### 4. **并发优化**
- 当前已实现异步TTS调用
- 可以考虑预生成常用响应

## 🔧 故障排除

### 延迟仍然很高
1. 检查网络连接速度
2. 验证使用的是新模型
3. 确认音频格式为wav或pcm
4. 检查系统资源使用情况

### 音质问题
1. 尝试不同的语音选项
2. 调整语速设置
3. 使用高质量模型 (tts-1-hd)

### 播放问题
1. 确认pygame已正确安装
2. 检查音频设备权限
3. 尝试不同的音频格式

## 📈 预期性能提升

使用优化后的配置，你应该能看到:
- **生成时间**: 减少 30-50%
- **总响应时间**: 减少 40-60%
- **音质**: 显著提升
- **系统稳定性**: 更好的错误处理和资源管理

## 🎵 语音选项说明

新的 `gpt-4o-mini-tts` 模型支持的语音:
- `coral`: 清晰自然，推荐用于助手
- `ash`: 温和友善
- `ballad`: 富有表现力
- `sage`: 沉稳专业
- `alloy`: 经典选择
